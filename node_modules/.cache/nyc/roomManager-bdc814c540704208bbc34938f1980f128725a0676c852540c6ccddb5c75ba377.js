function cov_1huth90sfx(){var path="/Users/tuanpnm/Class/SE181/realtime_interactive_chess/roomManager.js";var hash="98195e6d2d15e0e8c3fb302e4bdf117497ad8348";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/tuanpnm/Class/SE181/realtime_interactive_chess/roomManager.js",statementMap:{"0":{start:{line:4,column:4},end:{line:4,column:27}},"1":{start:{line:5,column:4},end:{line:5,column:26}},"2":{start:{line:6,column:4},end:{line:6,column:43}},"3":{start:{line:7,column:4},end:{line:7,column:25}},"4":{start:{line:9,column:4},end:{line:9,column:81}},"5":{start:{line:13,column:4},end:{line:17,column:8}},"6":{start:{line:14,column:6},end:{line:17,column:8}},"7":{start:{line:18,column:4},end:{line:21,column:6}},"8":{start:{line:24,column:22},end:{line:24,column:53}},"9":{start:{line:25,column:4},end:{line:26,column:25}},"10":{start:{line:26,column:6},end:{line:26,column:25}},"11":{start:{line:28,column:4},end:{line:33,column:5}},"12":{start:{line:29,column:6},end:{line:32,column:7}},"13":{start:{line:34,column:4},end:{line:38,column:8}},"14":{start:{line:35,column:6},end:{line:38,column:8}},"15":{start:{line:40,column:15},end:{line:40,column:37}},"16":{start:{line:42,column:4},end:{line:53,column:5}},"17":{start:{line:43,column:6},end:{line:52,column:7}},"18":{start:{line:44,column:8},end:{line:44,column:26}},"19":{start:{line:45,column:8},end:{line:46,column:38}},"20":{start:{line:46,column:10},end:{line:46,column:38}},"21":{start:{line:49,column:8},end:{line:49,column:26}},"22":{start:{line:50,column:8},end:{line:51,column:38}},"23":{start:{line:51,column:10},end:{line:51,column:38}},"24":{start:{line:54,column:4},end:{line:54,column:41}},"25":{start:{line:55,column:14},end:{line:55,column:32}},"26":{start:{line:56,column:4},end:{line:59,column:5}},"27":{start:{line:57,column:6},end:{line:57,column:25}},"28":{start:{line:58,column:6},end:{line:58,column:39}},"29":{start:{line:60,column:4},end:{line:63,column:6}},"30":{start:{line:66,column:22},end:{line:66,column:53}},"31":{start:{line:67,column:4},end:{line:68,column:25}},"32":{start:{line:68,column:6},end:{line:68,column:25}},"33":{start:{line:70,column:4},end:{line:74,column:8}},"34":{start:{line:71,column:6},end:{line:74,column:8}},"35":{start:{line:76,column:4},end:{line:81,column:5}},"36":{start:{line:77,column:6},end:{line:80,column:7}},"37":{start:{line:82,column:17},end:{line:82,column:39}},"38":{start:{line:84,column:19},end:{line:84,column:56}},"39":{start:{line:85,column:6},end:{line:93,column:7}},"40":{start:{line:95,column:6},end:{line:95,column:42}},"41":{start:{line:97,column:6},end:{line:100,column:8}},"42":{start:{line:103,column:18},end:{line:103,column:40}},"43":{start:{line:104,column:4},end:{line:104,column:38}},"44":{start:{line:105,column:4},end:{line:105,column:19}},"45":{start:{line:108,column:22},end:{line:108,column:53}},"46":{start:{line:109,column:4},end:{line:110,column:25}},"47":{start:{line:110,column:6},end:{line:110,column:25}},"48":{start:{line:111,column:4},end:{line:132,column:5}},"49":{start:{line:112,column:17},end:{line:112,column:44}},"50":{start:{line:114,column:6},end:{line:118,column:9}},"51":{start:{line:115,column:8},end:{line:118,column:9}},"52":{start:{line:120,column:6},end:{line:127,column:7}},"53":{start:{line:121,column:8},end:{line:121,column:23}},"54":{start:{line:122,column:8},end:{line:122,column:32}},"55":{start:{line:125,column:8},end:{line:125,column:23}},"56":{start:{line:126,column:8},end:{line:126,column:32}},"57":{start:{line:130,column:6},end:{line:130,column:24}},"58":{start:{line:131,column:6},end:{line:131,column:40}},"59":{start:{line:133,column:4},end:{line:136,column:5}},"60":{start:{line:140,column:4},end:{line:141,column:19}},"61":{start:{line:141,column:6},end:{line:141,column:19}},"62":{start:{line:142,column:4},end:{line:142,column:42}},"63":{start:{line:145,column:4},end:{line:146,column:18}},"64":{start:{line:146,column:6},end:{line:146,column:18}},"65":{start:{line:147,column:18},end:{line:147,column:44}},"66":{start:{line:149,column:4},end:{line:149,column:34}},"67":{start:{line:152,column:4},end:{line:153,column:19}},"68":{start:{line:153,column:6},end:{line:153,column:19}},"69":{start:{line:154,column:4},end:{line:154,column:40}},"70":{start:{line:157,column:4},end:{line:158,column:18}},"71":{start:{line:158,column:6},end:{line:158,column:18}},"72":{start:{line:159,column:4},end:{line:159,column:37}},"73":{start:{line:163,column:4},end:{line:164,column:19}},"74":{start:{line:164,column:6},end:{line:164,column:19}},"75":{start:{line:166,column:15},end:{line:166,column:37}},"76":{start:{line:167,column:4},end:{line:168,column:18}},"77":{start:{line:168,column:6},end:{line:168,column:18}},"78":{start:{line:169,column:4},end:{line:169,column:17}},"79":{start:{line:172,column:4},end:{line:173,column:19}},"80":{start:{line:173,column:6},end:{line:173,column:19}},"81":{start:{line:175,column:15},end:{line:175,column:37}},"82":{start:{line:176,column:4},end:{line:177,column:18}},"83":{start:{line:177,column:6},end:{line:177,column:18}},"84":{start:{line:179,column:4},end:{line:180,column:19}},"85":{start:{line:180,column:6},end:{line:180,column:19}},"86":{start:{line:181,column:4},end:{line:181,column:16}},"87":{start:{line:184,column:17},end:{line:184,column:42}},"88":{start:{line:185,column:4},end:{line:187,column:5}},"89":{start:{line:186,column:6},end:{line:186,column:41}},"90":{start:{line:188,column:4},end:{line:188,column:18}},"91":{start:{line:191,column:17},end:{line:191,column:42}},"92":{start:{line:192,column:4},end:{line:194,column:5}},"93":{start:{line:193,column:6},end:{line:193,column:41}},"94":{start:{line:195,column:4},end:{line:195,column:18}},"95":{start:{line:198,column:17},end:{line:198,column:48}},"96":{start:{line:199,column:13},end:{line:199,column:15}},"97":{start:{line:200,column:4},end:{line:202,column:5}},"98":{start:{line:200,column:16},end:{line:200,column:17}},"99":{start:{line:201,column:6},end:{line:201,column:69}},"100":{start:{line:203,column:4},end:{line:203,column:23}},"101":{start:{line:207,column:0},end:{line:207,column:29}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:3,column:2},end:{line:3,column:3}},loc:{start:{line:3,column:42},end:{line:11,column:3}},line:3},"1":{name:"(anonymous_1)",decl:{start:{line:12,column:2},end:{line:12,column:3}},loc:{start:{line:12,column:28},end:{line:22,column:3}},line:12},"2":{name:"(anonymous_2)",decl:{start:{line:23,column:2},end:{line:23,column:3}},loc:{start:{line:23,column:46},end:{line:64,column:3}},line:23},"3":{name:"(anonymous_3)",decl:{start:{line:65,column:2},end:{line:65,column:3}},loc:{start:{line:65,column:37},end:{line:101,column:3}},line:65},"4":{name:"(anonymous_4)",decl:{start:{line:102,column:2},end:{line:102,column:3}},loc:{start:{line:102,column:19},end:{line:106,column:3}},line:102},"5":{name:"(anonymous_5)",decl:{start:{line:107,column:2},end:{line:107,column:3}},loc:{start:{line:107,column:20},end:{line:138,column:3}},line:107},"6":{name:"(anonymous_6)",decl:{start:{line:139,column:2},end:{line:139,column:3}},loc:{start:{line:139,column:24},end:{line:143,column:3}},line:139},"7":{name:"(anonymous_7)",decl:{start:{line:144,column:2},end:{line:144,column:3}},loc:{start:{line:144,column:24},end:{line:150,column:3}},line:144},"8":{name:"(anonymous_8)",decl:{start:{line:151,column:2},end:{line:151,column:3}},loc:{start:{line:151,column:24},end:{line:155,column:3}},line:151},"9":{name:"(anonymous_9)",decl:{start:{line:156,column:2},end:{line:156,column:3}},loc:{start:{line:156,column:19},end:{line:160,column:3}},line:156},"10":{name:"(anonymous_10)",decl:{start:{line:162,column:2},end:{line:162,column:3}},loc:{start:{line:162,column:18},end:{line:170,column:3}},line:162},"11":{name:"(anonymous_11)",decl:{start:{line:171,column:2},end:{line:171,column:3}},loc:{start:{line:171,column:38},end:{line:182,column:3}},line:171},"12":{name:"(anonymous_12)",decl:{start:{line:183,column:2},end:{line:183,column:3}},loc:{start:{line:183,column:19},end:{line:189,column:3}},line:183},"13":{name:"(anonymous_13)",decl:{start:{line:190,column:2},end:{line:190,column:3}},loc:{start:{line:190,column:19},end:{line:196,column:3}},line:190},"14":{name:"(anonymous_14)",decl:{start:{line:197,column:2},end:{line:197,column:3}},loc:{start:{line:197,column:22},end:{line:204,column:3}},line:197}},branchMap:{"0":{loc:{start:{line:3,column:31},end:{line:3,column:41}},type:"default-arg",locations:[{start:{line:3,column:36},end:{line:3,column:41}}],line:3},"1":{loc:{start:{line:13,column:4},end:{line:17,column:8}},type:"if",locations:[{start:{line:13,column:4},end:{line:17,column:8}},{start:{line:13,column:4},end:{line:17,column:8}}],line:13},"2":{loc:{start:{line:23,column:30},end:{line:23,column:45}},type:"default-arg",locations:[{start:{line:23,column:41},end:{line:23,column:45}}],line:23},"3":{loc:{start:{line:25,column:4},end:{line:26,column:25}},type:"if",locations:[{start:{line:25,column:4},end:{line:26,column:25}},{start:{line:25,column:4},end:{line:26,column:25}}],line:25},"4":{loc:{start:{line:28,column:4},end:{line:33,column:5}},type:"if",locations:[{start:{line:28,column:4},end:{line:33,column:5}},{start:{line:28,column:4},end:{line:33,column:5}}],line:28},"5":{loc:{start:{line:28,column:7},end:{line:28,column:82}},type:"binary-expr",locations:[{start:{line:28,column:7},end:{line:28,column:41}},{start:{line:28,column:45},end:{line:28,column:82}}],line:28},"6":{loc:{start:{line:34,column:4},end:{line:38,column:8}},type:"if",locations:[{start:{line:34,column:4},end:{line:38,column:8}},{start:{line:34,column:4},end:{line:38,column:8}}],line:34},"7":{loc:{start:{line:42,column:4},end:{line:53,column:5}},type:"if",locations:[{start:{line:42,column:4},end:{line:53,column:5}},{start:{line:42,column:4},end:{line:53,column:5}}],line:42},"8":{loc:{start:{line:42,column:7},end:{line:42,column:47}},type:"binary-expr",locations:[{start:{line:42,column:7},end:{line:42,column:25}},{start:{line:42,column:29},end:{line:42,column:47}}],line:42},"9":{loc:{start:{line:43,column:6},end:{line:52,column:7}},type:"if",locations:[{start:{line:43,column:6},end:{line:52,column:7}},{start:{line:43,column:6},end:{line:52,column:7}}],line:43},"10":{loc:{start:{line:45,column:8},end:{line:46,column:38}},type:"if",locations:[{start:{line:45,column:8},end:{line:46,column:38}},{start:{line:45,column:8},end:{line:46,column:38}}],line:45},"11":{loc:{start:{line:50,column:8},end:{line:51,column:38}},type:"if",locations:[{start:{line:50,column:8},end:{line:51,column:38}},{start:{line:50,column:8},end:{line:51,column:38}}],line:50},"12":{loc:{start:{line:56,column:4},end:{line:59,column:5}},type:"if",locations:[{start:{line:56,column:4},end:{line:59,column:5}},{start:{line:56,column:4},end:{line:59,column:5}}],line:56},"13":{loc:{start:{line:65,column:23},end:{line:65,column:36}},type:"default-arg",locations:[{start:{line:65,column:32},end:{line:65,column:36}}],line:65},"14":{loc:{start:{line:67,column:4},end:{line:68,column:25}},type:"if",locations:[{start:{line:67,column:4},end:{line:68,column:25}},{start:{line:67,column:4},end:{line:68,column:25}}],line:67},"15":{loc:{start:{line:70,column:4},end:{line:74,column:8}},type:"if",locations:[{start:{line:70,column:4},end:{line:74,column:8}},{start:{line:70,column:4},end:{line:74,column:8}}],line:70},"16":{loc:{start:{line:76,column:4},end:{line:81,column:5}},type:"if",locations:[{start:{line:76,column:4},end:{line:81,column:5}},{start:{line:76,column:4},end:{line:81,column:5}}],line:76},"17":{loc:{start:{line:109,column:4},end:{line:110,column:25}},type:"if",locations:[{start:{line:109,column:4},end:{line:110,column:25}},{start:{line:109,column:4},end:{line:110,column:25}}],line:109},"18":{loc:{start:{line:111,column:4},end:{line:132,column:5}},type:"if",locations:[{start:{line:111,column:4},end:{line:132,column:5}},{start:{line:111,column:4},end:{line:132,column:5}}],line:111},"19":{loc:{start:{line:114,column:6},end:{line:118,column:9}},type:"if",locations:[{start:{line:114,column:6},end:{line:118,column:9}},{start:{line:114,column:6},end:{line:118,column:9}}],line:114},"20":{loc:{start:{line:120,column:6},end:{line:127,column:7}},type:"if",locations:[{start:{line:120,column:6},end:{line:127,column:7}},{start:{line:120,column:6},end:{line:127,column:7}}],line:120},"21":{loc:{start:{line:140,column:4},end:{line:141,column:19}},type:"if",locations:[{start:{line:140,column:4},end:{line:141,column:19}},{start:{line:140,column:4},end:{line:141,column:19}}],line:140},"22":{loc:{start:{line:145,column:4},end:{line:146,column:18}},type:"if",locations:[{start:{line:145,column:4},end:{line:146,column:18}},{start:{line:145,column:4},end:{line:146,column:18}}],line:145},"23":{loc:{start:{line:152,column:4},end:{line:153,column:19}},type:"if",locations:[{start:{line:152,column:4},end:{line:153,column:19}},{start:{line:152,column:4},end:{line:153,column:19}}],line:152},"24":{loc:{start:{line:157,column:4},end:{line:158,column:18}},type:"if",locations:[{start:{line:157,column:4},end:{line:158,column:18}},{start:{line:157,column:4},end:{line:158,column:18}}],line:157},"25":{loc:{start:{line:163,column:4},end:{line:164,column:19}},type:"if",locations:[{start:{line:163,column:4},end:{line:164,column:19}},{start:{line:163,column:4},end:{line:164,column:19}}],line:163},"26":{loc:{start:{line:167,column:4},end:{line:168,column:18}},type:"if",locations:[{start:{line:167,column:4},end:{line:168,column:18}},{start:{line:167,column:4},end:{line:168,column:18}}],line:167},"27":{loc:{start:{line:167,column:7},end:{line:167,column:41}},type:"binary-expr",locations:[{start:{line:167,column:7},end:{line:167,column:22}},{start:{line:167,column:26},end:{line:167,column:41}}],line:167},"28":{loc:{start:{line:172,column:4},end:{line:173,column:19}},type:"if",locations:[{start:{line:172,column:4},end:{line:173,column:19}},{start:{line:172,column:4},end:{line:173,column:19}}],line:172},"29":{loc:{start:{line:176,column:4},end:{line:177,column:18}},type:"if",locations:[{start:{line:176,column:4},end:{line:177,column:18}},{start:{line:176,column:4},end:{line:177,column:18}}],line:176},"30":{loc:{start:{line:176,column:7},end:{line:176,column:47}},type:"binary-expr",locations:[{start:{line:176,column:7},end:{line:176,column:25}},{start:{line:176,column:29},end:{line:176,column:47}}],line:176},"31":{loc:{start:{line:179,column:4},end:{line:180,column:19}},type:"if",locations:[{start:{line:179,column:4},end:{line:180,column:19}},{start:{line:179,column:4},end:{line:180,column:19}}],line:179}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},b:{"0":[0],"1":[0,0],"2":[0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"98195e6d2d15e0e8c3fb302e4bdf117497ad8348"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1huth90sfx=function(){return actualCoverage;};return actualCoverage;}cov_1huth90sfx();class RoomManager{constructor(request_handler,size=(cov_1huth90sfx().b[0][0]++,30000)){cov_1huth90sfx().f[0]++;cov_1huth90sfx().s[0]++;this.USER_TO_ROOM={};cov_1huth90sfx().s[1]++;this.ROOMS_STATE={};cov_1huth90sfx().s[2]++;this.REQUEST_HANDLER=request_handler;cov_1huth90sfx().s[3]++;this.max_size=size;//for random generator
cov_1huth90sfx().s[4]++;this.CHAR='abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';}authenticate_user(user_id){cov_1huth90sfx().f[1]++;cov_1huth90sfx().s[5]++;//public
if(!this.is_user_exist(user_id)){cov_1huth90sfx().b[1][0]++;cov_1huth90sfx().s[6]++;return{success:false,msg:"Failed to authenticate the user"};}else{cov_1huth90sfx().b[1][1]++;}cov_1huth90sfx().s[7]++;return{success:true,msg:"Success!"};}join_room(user_id,room_id,username=(cov_1huth90sfx().b[2][0]++,null)){cov_1huth90sfx().f[2]++;//public
var auth_result=(cov_1huth90sfx().s[8]++,this.authenticate_user(user_id));cov_1huth90sfx().s[9]++;if(!auth_result.success){cov_1huth90sfx().b[3][0]++;cov_1huth90sfx().s[10]++;return auth_result;}else{cov_1huth90sfx().b[3][1]++;}cov_1huth90sfx().s[11]++;if((cov_1huth90sfx().b[5][0]++,this.USER_TO_ROOM[user_id]!=null)&&(cov_1huth90sfx().b[5][1]++,this.USER_TO_ROOM[user_id]!=room_id)){cov_1huth90sfx().b[4][0]++;cov_1huth90sfx().s[12]++;return{success:false,msg:"You have already join a different room"};}else{cov_1huth90sfx().b[4][1]++;}cov_1huth90sfx().s[13]++;if(!this.valid_room_to_join(user_id,room_id)){cov_1huth90sfx().b[6][0]++;cov_1huth90sfx().s[14]++;return{success:false,msg:"The room is full or does not exist! Please try a different room ID"};}else{cov_1huth90sfx().b[6][1]++;}var room=(cov_1huth90sfx().s[15]++,this.get_room(room_id));cov_1huth90sfx().s[16]++;if((cov_1huth90sfx().b[8][0]++,room.p1!=user_id)&&(cov_1huth90sfx().b[8][1]++,room.p2!=user_id)){cov_1huth90sfx().b[7][0]++;cov_1huth90sfx().s[17]++;if(room.p1==null){cov_1huth90sfx().b[9][0]++;cov_1huth90sfx().s[18]++;room.p1=user_id;cov_1huth90sfx().s[19]++;if(username!=null){cov_1huth90sfx().b[10][0]++;cov_1huth90sfx().s[20]++;room.p1_username=username;}else{cov_1huth90sfx().b[10][1]++;}}else{cov_1huth90sfx().b[9][1]++;cov_1huth90sfx().s[21]++;room.p2=user_id;cov_1huth90sfx().s[22]++;if(username!=null){cov_1huth90sfx().b[11][0]++;cov_1huth90sfx().s[23]++;room.p2_username=username;}else{cov_1huth90sfx().b[11][1]++;}}}else{cov_1huth90sfx().b[7][1]++;}cov_1huth90sfx().s[24]++;this.USER_TO_ROOM[user_id]=room_id;var msg=(cov_1huth90sfx().s[25]++,"Success to join!");cov_1huth90sfx().s[26]++;if(this.is_full(room_id)){cov_1huth90sfx().b[12][0]++;cov_1huth90sfx().s[27]++;room.pause=false;cov_1huth90sfx().s[28]++;msg="Ready to start the game!";}else{cov_1huth90sfx().b[12][1]++;}cov_1huth90sfx().s[29]++;return{success:true,msg:msg};}create_room(user_id,username=(cov_1huth90sfx().b[13][0]++,null)){cov_1huth90sfx().f[3]++;//public
var auth_result=(cov_1huth90sfx().s[30]++,this.authenticate_user(user_id));cov_1huth90sfx().s[31]++;if(!auth_result.success){cov_1huth90sfx().b[14][0]++;cov_1huth90sfx().s[32]++;return auth_result;}else{cov_1huth90sfx().b[14][1]++;}cov_1huth90sfx().s[33]++;if(this.ROOMS_STATE.length==this.max_size){cov_1huth90sfx().b[15][0]++;cov_1huth90sfx().s[34]++;return{success:false,msg:"We have filled all rooms! Please try again later!"};}else{cov_1huth90sfx().b[15][1]++;}cov_1huth90sfx().s[35]++;if(this.USER_TO_ROOM[user_id]!=null){cov_1huth90sfx().b[16][0]++;cov_1huth90sfx().s[36]++;return{success:false,msg:"You have already join a room"};}else{cov_1huth90sfx().b[16][1]++;}var new_id=(cov_1huth90sfx().s[37]++,this.get_new_room_id());var new_game=(cov_1huth90sfx().s[38]++,this.REQUEST_HANDLER.new_chess_game());cov_1huth90sfx().s[39]++;this.ROOMS_STATE[new_id]={room_number:new_id,p1:user_id,p1_username:username,p2:null,p2_username:null,chess:new_game,pause:true};cov_1huth90sfx().s[40]++;this.USER_TO_ROOM[user_id]=new_id;cov_1huth90sfx().s[41]++;return{success:true,msg:"Success!"};}create_new_user(){cov_1huth90sfx().f[4]++;//public
var user_id=(cov_1huth90sfx().s[42]++,this.get_new_user_id());cov_1huth90sfx().s[43]++;this.USER_TO_ROOM[user_id]=null;cov_1huth90sfx().s[44]++;return user_id;}quit_room(user_id){cov_1huth90sfx().f[5]++;var auth_result=(cov_1huth90sfx().s[45]++,this.authenticate_user(user_id));cov_1huth90sfx().s[46]++;if(!auth_result.success){cov_1huth90sfx().b[17][0]++;cov_1huth90sfx().s[47]++;return auth_result;}else{cov_1huth90sfx().b[17][1]++;}cov_1huth90sfx().s[48]++;if(user_id in this.USER_TO_ROOM){cov_1huth90sfx().b[18][0]++;var room=(cov_1huth90sfx().s[49]++,this.get_user_room(user_id));//remove user from room state
cov_1huth90sfx().s[50]++;if(room==null){cov_1huth90sfx().b[19][0]++;cov_1huth90sfx().s[51]++;return{success:false,msg:"You did not enter a room!"};}else{cov_1huth90sfx().b[19][1]++;}cov_1huth90sfx().s[52]++;if(room.p1==user_id){cov_1huth90sfx().b[20][0]++;cov_1huth90sfx().s[53]++;room.p1=null;cov_1huth90sfx().s[54]++;room.p1_username=null;}else{cov_1huth90sfx().b[20][1]++;cov_1huth90sfx().s[55]++;room.p2=null;cov_1huth90sfx().s[56]++;room.p2_username=null;}//delete the mapping
cov_1huth90sfx().s[57]++;room.pause=true;cov_1huth90sfx().s[58]++;delete this.USER_TO_ROOM[user_id];}else{cov_1huth90sfx().b[18][1]++;}cov_1huth90sfx().s[59]++;return{success:true,msg:"Success to quit room!"};}is_user_exist(user_id){cov_1huth90sfx().f[6]++;cov_1huth90sfx().s[60]++;if(user_id==null){cov_1huth90sfx().b[21][0]++;cov_1huth90sfx().s[61]++;return false;}else{cov_1huth90sfx().b[21][1]++;}cov_1huth90sfx().s[62]++;return user_id in this.USER_TO_ROOM;}get_user_room(user_id){cov_1huth90sfx().f[7]++;cov_1huth90sfx().s[63]++;//public
if(!this.is_user_exist(user_id)){cov_1huth90sfx().b[22][0]++;cov_1huth90sfx().s[64]++;return null;}else{cov_1huth90sfx().b[22][1]++;}var room_id=(cov_1huth90sfx().s[65]++,this.USER_TO_ROOM[user_id]);cov_1huth90sfx().s[66]++;return this.get_room(room_id);}is_room_exist(room_id){cov_1huth90sfx().f[8]++;cov_1huth90sfx().s[67]++;if(room_id==null){cov_1huth90sfx().b[23][0]++;cov_1huth90sfx().s[68]++;return false;}else{cov_1huth90sfx().b[23][1]++;}cov_1huth90sfx().s[69]++;return room_id in this.ROOMS_STATE;}get_room(room_id){cov_1huth90sfx().f[9]++;cov_1huth90sfx().s[70]++;if(!this.is_room_exist(room_id)){cov_1huth90sfx().b[24][0]++;cov_1huth90sfx().s[71]++;return null;}else{cov_1huth90sfx().b[24][1]++;}cov_1huth90sfx().s[72]++;return this.ROOMS_STATE[room_id];}is_full(room_id){cov_1huth90sfx().f[10]++;cov_1huth90sfx().s[73]++;//private, should only be use by Room Manager
if(!this.is_room_exist(room_id)){cov_1huth90sfx().b[25][0]++;cov_1huth90sfx().s[74]++;//should not enter here
return false;}else{cov_1huth90sfx().b[25][1]++;}var room=(cov_1huth90sfx().s[75]++,this.get_room(room_id));cov_1huth90sfx().s[76]++;if((cov_1huth90sfx().b[27][0]++,room.p1!=null)&&(cov_1huth90sfx().b[27][1]++,room.p2!=null)){cov_1huth90sfx().b[26][0]++;cov_1huth90sfx().s[77]++;return true;}else{cov_1huth90sfx().b[26][1]++;}cov_1huth90sfx().s[78]++;return false;}valid_room_to_join(user_id,room_id){cov_1huth90sfx().f[11]++;cov_1huth90sfx().s[79]++;if(!this.is_room_exist(room_id)){cov_1huth90sfx().b[28][0]++;cov_1huth90sfx().s[80]++;return false;}else{cov_1huth90sfx().b[28][1]++;}var room=(cov_1huth90sfx().s[81]++,this.get_room(room_id));cov_1huth90sfx().s[82]++;if((cov_1huth90sfx().b[30][0]++,room.p1==user_id)||(cov_1huth90sfx().b[30][1]++,room.p2==user_id)){cov_1huth90sfx().b[29][0]++;cov_1huth90sfx().s[83]++;return true;}else{cov_1huth90sfx().b[29][1]++;}cov_1huth90sfx().s[84]++;if(this.is_full(room_id)){cov_1huth90sfx().b[31][0]++;cov_1huth90sfx().s[85]++;return false;}else{cov_1huth90sfx().b[31][1]++;}cov_1huth90sfx().s[86]++;return true;}get_new_user_id(){cov_1huth90sfx().f[12]++;var new_id=(cov_1huth90sfx().s[87]++,this.generate_random_id());cov_1huth90sfx().s[88]++;while(this.is_user_exist(new_id)){cov_1huth90sfx().s[89]++;new_id=this.generate_random_id();}cov_1huth90sfx().s[90]++;return new_id;}get_new_room_id(){cov_1huth90sfx().f[13]++;var new_id=(cov_1huth90sfx().s[91]++,this.generate_random_id());cov_1huth90sfx().s[92]++;while(this.is_room_exist(new_id)){cov_1huth90sfx().s[93]++;new_id=this.generate_random_id();}cov_1huth90sfx().s[94]++;return new_id;}generate_random_id(){cov_1huth90sfx().f[14]++;//might need a new class in the future
var length=(cov_1huth90sfx().s[95]++,Math.floor(Math.random()*3)+5);var id=(cov_1huth90sfx().s[96]++,[]);cov_1huth90sfx().s[97]++;for(var i=(cov_1huth90sfx().s[98]++,0);i<length;i++){cov_1huth90sfx().s[99]++;id.push(this.CHAR[Math.floor(Math.random()*this.CHAR.length)]);}cov_1huth90sfx().s[100]++;return id.join('');}}cov_1huth90sfx().s[101]++;module.exports=RoomManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvb21NYW5hZ2VyLmpzIl0sIm5hbWVzIjpbIlJvb21NYW5hZ2VyIiwiY29uc3RydWN0b3IiLCJyZXF1ZXN0X2hhbmRsZXIiLCJzaXplIiwiVVNFUl9UT19ST09NIiwiUk9PTVNfU1RBVEUiLCJSRVFVRVNUX0hBTkRMRVIiLCJtYXhfc2l6ZSIsIkNIQVIiLCJhdXRoZW50aWNhdGVfdXNlciIsInVzZXJfaWQiLCJpc191c2VyX2V4aXN0Iiwic3VjY2VzcyIsIm1zZyIsImpvaW5fcm9vbSIsInJvb21faWQiLCJ1c2VybmFtZSIsImF1dGhfcmVzdWx0IiwidmFsaWRfcm9vbV90b19qb2luIiwicm9vbSIsImdldF9yb29tIiwicDEiLCJwMiIsInAxX3VzZXJuYW1lIiwicDJfdXNlcm5hbWUiLCJpc19mdWxsIiwicGF1c2UiLCJjcmVhdGVfcm9vbSIsImxlbmd0aCIsIm5ld19pZCIsImdldF9uZXdfcm9vbV9pZCIsIm5ld19nYW1lIiwibmV3X2NoZXNzX2dhbWUiLCJyb29tX251bWJlciIsImNoZXNzIiwiY3JlYXRlX25ld191c2VyIiwiZ2V0X25ld191c2VyX2lkIiwicXVpdF9yb29tIiwiZ2V0X3VzZXJfcm9vbSIsImlzX3Jvb21fZXhpc3QiLCJnZW5lcmF0ZV9yYW5kb21faWQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJpZCIsImkiLCJwdXNoIiwiam9pbiIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJtdGZBQ0EsS0FBTUEsQ0FBQUEsV0FBVyxDQUNmQyxXQUFXLENBQUNDLGVBQUQsQ0FBa0JDLElBQUksNkJBQUMsS0FBRCxDQUF0QixDQUE2QixpREFDdEMsS0FBS0MsWUFBTCxDQUFvQixFQUFwQixDQURzQyx3QkFFdEMsS0FBS0MsV0FBTCxDQUFtQixFQUFuQixDQUZzQyx3QkFHdEMsS0FBS0MsZUFBTCxDQUF1QkosZUFBdkIsQ0FIc0Msd0JBSXRDLEtBQUtLLFFBQUwsQ0FBZ0JKLElBQWhCLENBQ0E7QUFMc0Msd0JBTXRDLEtBQUtLLElB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Q0FBQyxFQUE1QixDQUErQiwwQkFDN0JELEVBQUUsQ0FBQ0UsSUFBSCxDQUFRLEtBQUt0QyxJQUFMLENBQVVpQyxJQUFJLENBQUNDLEtBQUwsQ0FBV0QsSUFBSSxDQUFDRSxNQUFMLEdBQWMsS0FBS25DLElBQUwsQ0FBVW9CLE1BQW5DLENBQVYsQ0FBUixFQUNELENBTGlCLDBCQU1sQixNQUFPZ0IsQ0FBQUEsRUFBRSxDQUFDRyxJQUFILENBQVEsRUFBUixDQUFQLENBQ0QsQ0ExTWMsQywwQkE2TWpCQyxNQUFNLENBQUNDLE9BQVAsQ0FBaUJqRCxXQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIlxuY2xhc3MgUm9vbU1hbmFnZXJ7XG4gIGNvbnN0cnVjdG9yKHJlcXVlc3RfaGFuZGxlciwgc2l6ZT0zMDAwMCl7XG4gICAgdGhpcy5VU0VSX1RPX1JPT00gPSB7fTtcbiAgICB0aGlzLlJPT01TX1NUQVRFID0ge307XG4gICAgdGhpcy5SRVFVRVNUX0hBTkRMRVIgPSByZXF1ZXN0X2hhbmRsZXI7XG4gICAgdGhpcy5tYXhfc2l6ZSA9IHNpemU7XG4gICAgLy9mb3IgcmFuZG9tIGdlbmVyYXRvclxuICAgIHRoaXMuQ0hBUiA9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWic7XG5cbiAgfVxuICBhdXRoZW50aWNhdGVfdXNlcih1c2VyX2lkKXsgLy9wdWJsaWNcbiAgICBpZighdGhpcy5pc191c2VyX2V4aXN0KHVzZXJfaWQpKVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1zZzogXCJGYWlsZWQgdG8gYXV0aGVudGljYXRlIHRoZSB1c2VyXCJcbiAgICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtc2c6IFwiU3VjY2VzcyFcIlxuICAgIH07XG4gIH1cbiAgam9pbl9yb29tKHVzZXJfaWQsIHJvb21faWQsIHVzZXJuYW1lID0gbnVsbCl7IC8vcHVibGljXG4gICAgdmFyIGF1dGhfcmVzdWx0ID0gdGhpcy5hdXRoZW50aWNhdGVfdXNlcih1c2VyX2lkKTtcbiAgICBpZighYXV0aF9yZXN1bHQuc3VjY2VzcylcbiAgICAgIHJldHVybiBhdXRoX3Jlc3VsdDtcblxuICAgIGlmKHRoaXMuVVNFUl9UT19ST09NW3VzZXJfaWRdICE9IG51bGwgJiYgdGhpcy5VU0VSX1RPX1JPT01bdXNlcl9pZF0gIT0gcm9vbV9pZCl7XG4gICAgICByZXR1cm57XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtc2c6IFwiWW91IGhhdmUgYWxyZWFkeSBqb2luIGEgZGlmZmVyZW50IHJvb21cIlxuICAgICAgfVxuICAgIH1cbiAgICBpZighdGhpcy52YWxpZF9yb29tX3RvX2pvaW4odXNlcl9pZCwgcm9vbV9pZCkpXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOmZhbHNlLFxuICAgICAgICBtc2c6IFwiVGhlIHJvb20gaXMgZnVsbCBvciBkb2VzIG5vdCBleGlzdCEgUGxlYXNlIHRyeSBhIGRpZmZlcmVudCByb29tIElEXCJcbiAgICAgIH07XG5cbiAgICB2YXIgcm9vbSA9IHRoaXMuZ2V0X3Jvb20ocm9vbV9pZCk7XG5cbiAgICBpZihyb29tLnAxICE9IHVzZXJfaWQgJiYgcm9vbS5wMiAhPSB1c2VyX2lkKXtcbiAgICAgIGlmKHJvb20ucDEgPT0gbnVsbCl7XG4gICAgICAgIHJvb20ucDEgPSB1c2VyX2lkO1xuICAgICAgICBpZih1c2VybmFtZSAhPSBudWxsKVxuICAgICAgICAgIHJvb20ucDFfdXNlcm5hbWUgPSB1c2VybmFtZTtcbiAgICAgIH1cbiAgICAgIGVsc2V7XG4gICAgICAgIHJvb20ucDIgPSB1c2VyX2lkO1xuICAgICAgICBpZih1c2VybmFtZSAhPSBudWxsKVxuICAgICAgICAgIHJvb20ucDJfdXNlcm5hbWUgPSB1c2VybmFtZTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5VU0VSX1RPX1JPT01bdXNlcl9pZF0gPSByb29tX2lkO1xuICAgIHZhciBtc2cgPSBcIlN1Y2Nlc3MgdG8gam9pbiFcIjtcbiAgICBpZih0aGlzLmlzX2Z1bGwocm9vbV9pZCkpe1xuICAgICAgcm9vbS5wYXVzZSA9IGZhbHNlO1xuICAgICAgbXNnID0gXCJSZWFkeSB0byBzdGFydCB0aGUgZ2FtZSFcIjtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtc2c6IG1zZ1xuICAgIH07XG4gIH1cbiAgY3JlYXRlX3Jvb20odXNlcl9pZCwgdXNlcm5hbWU9bnVsbCl7IC8vcHVibGljXG4gICAgdmFyIGF1dGhfcmVzdWx0ID0gdGhpcy5hdXRoZW50aWNhdGVfdXNlcih1c2VyX2lkKTtcbiAgICBpZighYXV0aF9yZXN1bHQuc3VjY2VzcylcbiAgICAgIHJldHVybiBhdXRoX3Jlc3VsdDtcblxuICAgIGlmKHRoaXMuUk9PTVNfU1RBVEUubGVuZ3RoID09IHRoaXMubWF4X3NpemUpXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbXNnOiBcIldlIGhhdmUgZmlsbGVkIGFsbCByb29tcyEgUGxlYXNlIHRyeSBhZ2FpbiBsYXRlciFcIlxuICAgICAgfTtcblxuICAgIGlmKHRoaXMuVVNFUl9UT19ST09NW3VzZXJfaWRdICE9IG51bGwpe1xuICAgICAgcmV0dXJue1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbXNnOiBcIllvdSBoYXZlIGFscmVhZHkgam9pbiBhIHJvb21cIlxuICAgICAgfVxuICAgIH1cbiAgICB2YXIgbmV3X2lkID0gdGhpcy5nZXRfbmV3X3Jvb21faWQoKTtcblxuICAgIHZhciBuZXdfZ2FtZSA9IHRoaXMuUkVRVUVTVF9IQU5ETEVSLm5ld19jaGVzc19nYW1lKCk7XG4gICAgICB0aGlzLlJPT01TX1NUQVRFW25ld19pZF0gPSB7XG4gICAgICAgIHJvb21fbnVtYmVyOiBuZXdfaWQsXG4gICAgICAgIHAxOiB1c2VyX2lkLFxuICAgICAgICBwMV91c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgIHAyOiBudWxsLFxuICAgICAgICBwMl91c2VybmFtZTogbnVsbCxcbiAgICAgICAgY2hlc3M6IG5ld19nYW1lLFxuICAgICAgICBwYXVzZTogdHJ1ZVxuICAgICAgfVxuXG4gICAgICB0aGlzLlVTRVJfVE9fUk9PTVt1c2VyX2lkXSA9IG5ld19pZDtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbXNnOiBcIlN1Y2Nlc3MhXCJcbiAgICAgIH07XG4gIH1cbiAgY3JlYXRlX25ld191c2VyKCl7IC8vcHVibGljXG4gICAgdmFyIHVzZXJfaWQgPSB0aGlzLmdldF9uZXdfdXNlcl9pZCgpO1xuICAgIHRoaXMuVVNFUl9UT19ST09NW3VzZXJfaWRdID0gbnVsbDtcbiAgICByZXR1cm4gdXNlcl9pZDtcbiAgfVxuICBxdWl0X3Jvb20odXNlcl9pZCl7XG4gICAgdmFyIGF1dGhfcmVzdWx0ID0gdGhpcy5hdXRoZW50aWNhdGVfdXNlcih1c2VyX2lkKTtcbiAgICBpZighYXV0aF9yZXN1bHQuc3VjY2VzcylcbiAgICAgIHJldHVybiBhdXRoX3Jlc3VsdDtcbiAgICBpZih1c2VyX2lkIGluIHRoaXMuVVNFUl9UT19ST09NKXtcbiAgICAgIHZhciByb29tID0gdGhpcy5nZXRfdXNlcl9yb29tKHVzZXJfaWQpO1xuICAgICAgLy9yZW1vdmUgdXNlciBmcm9tIHJvb20gc3RhdGVcbiAgICAgIGlmKHJvb20gPT0gbnVsbClcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtc2c6IFwiWW91IGRpZCBub3QgZW50ZXIgYSByb29tIVwiXG4gICAgICAgIH1cblxuICAgICAgaWYocm9vbS5wMSA9PSB1c2VyX2lkKXtcbiAgICAgICAgcm9vbS5wMSA9IG51bGw7XG4gICAgICAgIHJvb20ucDFfdXNlcm5hbWUgPSBudWxsO1xuICAgICAgfVxuICAgICAgZWxzZXtcbiAgICAgICAgcm9vbS5wMiA9IG51bGw7XG4gICAgICAgIHJvb20ucDJfdXNlcm5hbWUgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICAvL2RlbGV0ZSB0aGUgbWFwcGluZ1xuICAgICAgcm9vbS5wYXVzZSA9IHRydWU7XG4gICAgICBkZWxldGUgdGhpcy5VU0VSX1RPX1JPT01bdXNlcl9pZF07XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbXNnOiBcIlN1Y2Nlc3MgdG8gcXVpdCByb29tIVwiXG4gICAgfVxuXG4gIH1cbiAgaXNfdXNlcl9leGlzdCh1c2VyX2lkKXtcbiAgICBpZih1c2VyX2lkID09IG51bGwpXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuICh1c2VyX2lkIGluIHRoaXMuVVNFUl9UT19ST09NKTtcbiAgfVxuICBnZXRfdXNlcl9yb29tKHVzZXJfaWQpeyAvL3B1YmxpY1xuICAgIGlmKCF0aGlzLmlzX3VzZXJfZXhpc3QodXNlcl9pZCkpXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB2YXIgcm9vbV9pZCA9IHRoaXMuVVNFUl9UT19ST09NW3VzZXJfaWRdO1xuXG4gICAgcmV0dXJuIHRoaXMuZ2V0X3Jvb20ocm9vbV9pZCk7XG4gIH1cbiAgaXNfcm9vbV9leGlzdChyb29tX2lkKXtcbiAgICBpZihyb29tX2lkID09IG51bGwpXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIChyb29tX2lkIGluIHRoaXMuUk9PTVNfU1RBVEUpXG4gIH1cbiAgZ2V0X3Jvb20ocm9vbV9pZCl7XG4gICAgaWYoIXRoaXMuaXNfcm9vbV9leGlzdChyb29tX2lkKSlcbiAgICAgIHJldHVybiBudWxsO1xuICAgIHJldHVybiB0aGlzLlJPT01TX1NUQVRFW3Jvb21faWRdO1xuICB9XG5cbiAgaXNfZnVsbChyb29tX2lkKXsgLy9wcml2YXRlLCBzaG91bGQgb25seSBiZSB1c2UgYnkgUm9vbSBNYW5hZ2VyXG4gICAgaWYoIXRoaXMuaXNfcm9vbV9leGlzdChyb29tX2lkKSkgLy9zaG91bGQgbm90IGVudGVyIGhlcmVcbiAgICAgIHJldHVybiBmYWxzZTtcblxuICAgIHZhciByb29tID0gdGhpcy5nZXRfcm9vbShyb29tX2lkKTtcbiAgICBpZihyb29tLnAxICE9IG51bGwgJiYgcm9vbS5wMiAhPSBudWxsKVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHZhbGlkX3Jvb21fdG9fam9pbih1c2VyX2lkLCByb29tX2lkKXtcbiAgICBpZighdGhpcy5pc19yb29tX2V4aXN0KHJvb21faWQpKVxuICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgdmFyIHJvb20gPSB0aGlzLmdldF9yb29tKHJvb21faWQpO1xuICAgIGlmKHJvb20ucDEgPT0gdXNlcl9pZCB8fCByb29tLnAyID09IHVzZXJfaWQpXG4gICAgICByZXR1cm4gdHJ1ZTtcblxuICAgIGlmKHRoaXMuaXNfZnVsbChyb29tX2lkKSlcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBnZXRfbmV3X3VzZXJfaWQoKXtcbiAgICB2YXIgbmV3X2lkID0gdGhpcy5nZW5lcmF0ZV9yYW5kb21faWQoKTtcbiAgICB3aGlsZSh0aGlzLmlzX3VzZXJfZXhpc3QobmV3X2lkKSl7XG4gICAgICBuZXdfaWQgPSB0aGlzLmdlbmVyYXRlX3JhbmRvbV9pZCgpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3X2lkO1xuICB9XG4gIGdldF9uZXdfcm9vbV9pZCgpe1xuICAgIHZhciBuZXdfaWQgPSB0aGlzLmdlbmVyYXRlX3JhbmRvbV9pZCgpO1xuICAgIHdoaWxlKHRoaXMuaXNfcm9vbV9leGlzdChuZXdfaWQpKXtcbiAgICAgIG5ld19pZCA9IHRoaXMuZ2VuZXJhdGVfcmFuZG9tX2lkKCk7XG4gICAgfVxuICAgIHJldHVybiBuZXdfaWQ7XG4gIH1cbiAgZ2VuZXJhdGVfcmFuZG9tX2lkKCl7IC8vbWlnaHQgbmVlZCBhIG5ldyBjbGFzcyBpbiB0aGUgZnV0dXJlXG4gICAgdmFyIGxlbmd0aCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSozKSArIDU7XG4gICAgdmFyIGlkID0gW11cbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspe1xuICAgICAgaWQucHVzaCh0aGlzLkNIQVJbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKnRoaXMuQ0hBUi5sZW5ndGgpXSk7XG4gICAgfVxuICAgIHJldHVybiBpZC5qb2luKCcnKTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFJvb21NYW5hZ2VyO1xuIl19